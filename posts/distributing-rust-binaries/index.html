<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Building and Deploying Rust Binaries Across Linux Distributions. | Kurotych ðŸ‡ºðŸ‡¦</title>
<meta name=keywords content><meta name=description content="The Rust ecosystem has numerous platforms and extensive documentation to support cross-compilation features.
But does it work as expected?
Well, if your binary has few shared library dependencies, then it likely will. Compiling for x86_64-unknown-linux-musl significantly increases the likelihood that your binary will operate across different Linux distributions.
However, the reality in production can be quite different. We still encounter dependency hell, and many Rust crates rely on shared libraries that may have varying names and paths."><meta name=author content><link rel=canonical href=https://kurotych.com/posts/distributing-rust-binaries/><link crossorigin=anonymous href=/assets/css/stylesheet.c7de8a67c1dd55d6bcf016dd52f01b3e6b03a936133ea870d3e9249c157033d1.css integrity="sha256-x96KZ8HdVda88BbdUvAbPmsDqTYTPqhw0+kknBVwM9E=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://kurotych.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kurotych.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kurotych.com/favicon-32x32.png><link rel=apple-touch-icon href=https://kurotych.com/apple-touch-icon.png><link rel=mask-icon href=https://kurotych.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-HKDH744EMY"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-HKDH744EMY",{anonymize_ip:!1})}</script><meta property="og:title" content="Building and Deploying Rust Binaries Across Linux Distributions."><meta property="og:description" content="The Rust ecosystem has numerous platforms and extensive documentation to support cross-compilation features.
But does it work as expected?
Well, if your binary has few shared library dependencies, then it likely will. Compiling for x86_64-unknown-linux-musl significantly increases the likelihood that your binary will operate across different Linux distributions.
However, the reality in production can be quite different. We still encounter dependency hell, and many Rust crates rely on shared libraries that may have varying names and paths."><meta property="og:type" content="article"><meta property="og:url" content="https://kurotych.com/posts/distributing-rust-binaries/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-11T13:09:33+02:00"><meta property="article:modified_time" content="2024-02-11T13:09:33+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building and Deploying Rust Binaries Across Linux Distributions."><meta name=twitter:description content="The Rust ecosystem has numerous platforms and extensive documentation to support cross-compilation features.
But does it work as expected?
Well, if your binary has few shared library dependencies, then it likely will. Compiling for x86_64-unknown-linux-musl significantly increases the likelihood that your binary will operate across different Linux distributions.
However, the reality in production can be quite different. We still encounter dependency hell, and many Rust crates rely on shared libraries that may have varying names and paths."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://kurotych.com/posts/"},{"@type":"ListItem","position":3,"name":"Building and Deploying Rust Binaries Across Linux Distributions.","item":"https://kurotych.com/posts/distributing-rust-binaries/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Building and Deploying Rust Binaries Across Linux Distributions.","name":"Building and Deploying Rust Binaries Across Linux Distributions.","description":"The Rust ecosystem has numerous platforms and extensive documentation to support cross-compilation features.\nBut does it work as expected?\nWell, if your binary has few shared library dependencies, then it likely will. Compiling for x86_64-unknown-linux-musl significantly increases the likelihood that your binary will operate across different Linux distributions.\nHowever, the reality in production can be quite different. We still encounter dependency hell, and many Rust crates rely on shared libraries that may have varying names and paths.","keywords":[],"articleBody":"The Rust ecosystem has numerous platforms and extensive documentation to support cross-compilation features.\nBut does it work as expected?\nWell, if your binary has few shared library dependencies, then it likely will. Compiling for x86_64-unknown-linux-musl significantly increases the likelihood that your binary will operate across different Linux distributions.\nHowever, the reality in production can be quite different. We still encounter dependency hell, and many Rust crates rely on shared libraries that may have varying names and paths.\nOne of my projects has about 120 dependencies on shared library and codebase of this project is not big (It has around 10k lines with tests). (Despite my effors to minimize the amount of dependencies.)\nTo verify dependencies, I use the ldd Linux utility:\nldd libssl.so.3 =\u003e /lib/x86_64-linux-gnu/libssl.so.3 (0x00007f912c971000) libcrypto.so.3 =\u003e /lib/x86_64-linux-gnu/libcrypto.so.3 (0x00007f9129800000) ... libkeyutils.so.1 =\u003e /lib/x86_64-linux-gnu/libkeyutils.so.1 (0x00007f9124096000) libresolv.so.2 =\u003e /lib/x86_64-linux-gnu/libresolv.so.2 (0x00007f91239f9000) libquadmath.so.0 =\u003e /lib/x86_64-linux-gnu/libquadmath.so.0 (0x00007f9121bb9000) So, what are the chances that this binary, built on Debian 12, will work with Ubuntu 22.04, for example? (This question is rhetorical.)\nProblem The challenge is to build a binary, deliver it, and run it on an Ubuntu 22.04 VPS (or any other Linux distro you prefer) with only runtime dependencies.\nSolution Build binary in docker and export it to VPS.\nThe docker file that builds hello_world binary could looks something like:\nFROM ubuntu:22.04 AS build-stage ENV DEBIAN_FRONTEND=noninteractive # Install required dependencies RUN apt-get update \u0026\u0026 apt-get install -y --no-install-recommends \\ ... # A list of deps used to build binary \u0026\u0026 rm -rf /var/lib/apt/lists/* RUN curl https://sh.rustup.rs -sSf | bash -s -- -y # Set the working directory inside the container WORKDIR /usr/src/app/ COPY . . RUN SQLX_OFFLINE=true ~/.cargo/bin/cargo build --release FROM scratch AS export-stage COPY --from=build-stage /usr/src/app/target/release/hello_world CMD [\"/bin/bash\"] The build command docker build -f --output=bin . will deliver the built binary to bin directory.\nThen, you can use the scp utility to transfer this binary to your VPS.\nIf the binary requires certain shared libraries, you will need to install them with your package manager (in case of ubuntu apt or apt-get)\n","wordCount":"341","inLanguage":"en","datePublished":"2024-02-11T13:09:33+02:00","dateModified":"2024-02-11T13:09:33+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kurotych.com/posts/distributing-rust-binaries/"},"publisher":{"@type":"Organization","name":"Kurotych ðŸ‡ºðŸ‡¦","logo":{"@type":"ImageObject","url":"https://kurotych.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kurotych.com accesskey=h title="Kurotych ðŸ‡ºðŸ‡¦ (Alt + H)">Kurotych ðŸ‡ºðŸ‡¦</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kurotych.com/about/ title="About Me"><span>About Me</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Building and Deploying Rust Binaries Across Linux Distributions.</h1><div class=post-meta><span title='2024-02-11 13:09:33 +0200 +0200'>February 11, 2024</span></div></header><div class=post-content><p>The Rust ecosystem has numerous platforms and extensive documentation to support cross-compilation features.</p><p>But does it work as expected?</p><p>Well, if your binary has few shared library dependencies,
then it likely will. Compiling for <code>x86_64-unknown-linux-musl</code> significantly increases the likelihood that your binary will operate across different
Linux distributions.</p><p><strong>However</strong>, the reality in production can be quite different.
We still encounter dependency hell, and many Rust crates rely on shared libraries that may have varying names and paths.</p><p>One of my projects has about 120 dependencies on shared library and codebase of this project is not big (It has around 10k lines with tests).
(Despite my effors to minimize the amount of dependencies.)</p><p>To verify dependencies, I use the ldd Linux utility:</p><pre tabindex=0><code>ldd &lt;path_to_binary&gt;
	libssl.so.3 =&gt; /lib/x86_64-linux-gnu/libssl.so.3 (0x00007f912c971000)
	libcrypto.so.3 =&gt; /lib/x86_64-linux-gnu/libcrypto.so.3 (0x00007f9129800000)
    ...
	libkeyutils.so.1 =&gt; /lib/x86_64-linux-gnu/libkeyutils.so.1 (0x00007f9124096000)
	libresolv.so.2 =&gt; /lib/x86_64-linux-gnu/libresolv.so.2 (0x00007f91239f9000)
	libquadmath.so.0 =&gt; /lib/x86_64-linux-gnu/libquadmath.so.0 (0x00007f9121bb9000)
</code></pre><p>So, what are the chances that this binary, built on Debian 12, will work with Ubuntu 22.04, for example? (This question is rhetorical.)</p><h3 id=problem>Problem<a hidden class=anchor aria-hidden=true href=#problem>#</a></h3><p>The challenge is to build a binary, deliver it, and run it on an Ubuntu 22.04 VPS (or any other Linux distro you prefer) with only runtime dependencies.</p><h3 id=solution>Solution<a hidden class=anchor aria-hidden=true href=#solution>#</a></h3><p><a href=https://docs.docker.com/build/guide/export/>Build binary in docker and export it</a> to VPS.</p><p>The docker file that builds <strong>hello_world</strong> binary could looks something like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> ubuntu:22.04 AS build-stage</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> DEBIAN_FRONTEND<span style=color:#f92672>=</span>noninteractive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Install required dependencies</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get update <span style=color:#f92672>&amp;&amp;</span> apt-get install -y --no-install-recommends <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    &lt;package_name&gt;... <span style=color:#75715e># A list of deps used to build binary</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>    <span style=color:#f92672>&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> curl https://sh.rustup.rs -sSf | bash -s -- -y<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Set the working directory inside the container</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /usr/src/app/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> SQLX_OFFLINE<span style=color:#f92672>=</span>true ~/.cargo/bin/cargo build --release<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> scratch AS export-stage</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>build-stage /usr/src/app/target/release/hello_world<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;/bin/bash&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>The build command <code>docker build -f &lt;your_docker_file_name> --output=bin .</code> will deliver the built binary to <code>bin</code> directory.</p><p>Then, you can use the <code>scp</code> utility to transfer this binary to your VPS.</p><p>If the binary requires certain shared libraries, you will need to install them with your package manager (in case of ubuntu <code>apt</code> or <code>apt-get</code>)</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://kurotych.com>Kurotych ðŸ‡ºðŸ‡¦</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>